{% extends "base.html" %}

{% block title %}API Keys Management{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>API Keys Management</h2>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Create New API Key</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('api.create_api_key') }}">
                <div class="mb-3">
                    <label for="name" class="form-label">Key Name</label>
                    <input type="text" class="form-control" id="name" name="name" required 
                           placeholder="e.g., TV Planner Integration">
                </div>
                <button type="submit" class="btn btn-primary">Generate API Key</button>
            </form>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h5>Your API Keys</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Last Used</th>
                            <th>Use Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key in api_keys %}
                        <tr>
                            <td>{{ key.name }}</td>
                            <td>
                                {% if key.is_active %}
                                    <span class="badge bg-success">Active</span>
                                {% else %}
                                    <span class="badge bg-danger">Inactive</span>
                                {% endif %}
                            </td>
                            <td>{{ key.created_at.strftime('%Y-%m-%d %H:%M') if key.created_at else 'N/A' }}</td>
                            <td>{{ key.last_used_at.strftime('%Y-%m-%d %H:%M') if key.last_used_at else 'Never' }}</td>
                            <td>{{ key.use_count }}</td>
                            <td>
                                <form method="POST" style="display: inline;">
                                    <button formaction="{{ url_for('api.toggle_api_key', key_id=key.id) }}" 
                                            class="btn btn-sm btn-warning">
                                        {% if key.is_active %}Deactivate{% else %}Activate{% endif %}
                                    </button>
                                    <button formaction="{{ url_for('api.delete_api_key', key_id=key.id) }}" 
                                            class="btn btn-sm btn-danger"
                                            onclick="return confirm('Are you sure you want to delete this API key?')">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="text-center">No API keys found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="mt-4">
        <h5>API Documentation</h5>
        <p>Base URL: <code>{{ request.host_url }}api</code></p>
        <p>Authentication: Include your API key in the <code>X-API-Key</code> header</p>
        
        <h6>Available Endpoints:</h6>
        <ul>
            <li><code>GET /api/companies</code> - List all companies</li>
            <li><code>GET /api/companies/{id}</code> - Get company details</li>
            <li><code>GET /api/brands</code> - List all brands</li>
            <li><code>GET /api/brands/{id}</code> - Get brand details</li>
            <li><code>GET /api/contacts</code> - List all contacts</li>
            <li><code>GET /api/invoices</code> - List invoices</li>
            <li><code>GET /api/status-updates</code> - List status updates</li>
            <li><code>GET /api/planning-info</code> - List planning information</li>
        </ul>
    </div>
</div>
{% endblock %}